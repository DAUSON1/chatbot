<!DOCTYPE html>
<html lang="sw">
<head>
  <meta charset="UTF-8">
  <title>AI Chatbot</title>
  <style>
    body { font-family: Arial; background: #f5f5f5; display: flex; justify-content:center; align-items:center; height:100vh; margin:0;}
    .chat-container { width:420px; background:white; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,.1); display:flex; flex-direction:column; overflow:hidden; }
    .chat-box { flex:1; padding:10px; overflow-y:auto; }
    .user { text-align:right; margin:6px 0; color:#1d4ed8; }
    .bot { text-align:left; margin:6px 0; color:#16a34a; }
    .input-container { display:flex; border-top:1px solid #ddd; }
    input { flex:1; padding:10px; border:none; outline:none; }
    button { background:#007bff; color:#fff; border:0; padding:10px 14px; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    button:hover { background:#0056b3; }
    .status { font-size:12px; color:#555; padding:6px 10px; border-top:1px solid #eee; background:#fafafa; }
  </style>
</head>
<body>
  <div class="chat-container">
    <div id="chatBox" class="chat-box"></div>
    <div class="input-container">
      <input type="text" id="userInput" placeholder="Andika ujumbe..." />
      <button id="sendBtn" onclick="sendMessage()">Tuma</button>
    </div>
    <div id="status" class="status">Ready</div>
  </div>

<script>
const ENDPOINT = '/ai-chatbot/backend/chatbot.php';
const HISTORY = '/ai-chatbot/backend/history.php';

const chatBox = document.getElementById('chatBox');
const input = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const statusEl = document.getElementById('status');

input.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });

async function loadHistory() {
  try {
    const res = await fetch(HISTORY);
    const chats = await res.json();
    chatBox.innerHTML = "";
    chats.forEach(c => {
      chatBox.innerHTML += `<div class="user"><b>You:</b> ${c.user_message}</div>`;
      chatBox.innerHTML += `<div class="bot"><b>Bot:</b> ${c.bot_reply}</div>`;
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  } catch(err) {
    console.error(err);
  }
}

async function sendMessage() {
  const message = input.value.trim();
  if(!message) return;

  appendMsg('user', `You: ${message}`);
  input.value='';
  disableSend(true);
  statusEl.textContent='Inatuma...';

  try {
    const res = await fetch(ENDPOINT, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({message})
    });

    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    const botReply = data.reply ?? '(hakuna reply)';
    appendMsg('bot', `Bot: ${botReply}`);
  } catch(err) {
    appendMsg('bot', `Hitilafu: ${err.message}`);
  } finally {
    disableSend(false);
    statusEl.textContent='Ready';
  }
}

function appendMsg(role,text){
  const div=document.createElement('div');
  div.className=role;
  div.innerHTML=text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function disableSend(state){
  sendBtn.disabled=state;
  input.disabled=state;
}

// Load history on page load
window.onload = loadHistory;
</script>
</body>
</html>
